<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SANDEX SHOP ‚Äî Apple & Tech Store</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõí</text></svg>">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
  :root{
    --bg:#000000; --card:#1c1c1e; --accent:#2997ff; --muted:#86868b; --text:#f5f5f7;
  }
  *{box-sizing:border-box}
  body{font-family:-apple-system, BlinkMacSystemFont, "Inter", sans-serif; margin:0; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; min-height: 100vh; overflow-x: hidden;}
  header{padding:18px 20px; display:flex; gap:12px; align-items:center; justify-content:space-between; border-bottom:1px solid rgba(255,255,255,0.03); position: sticky; top: 0; z-index: 1000; background: rgba(5,6,10,0.8); backdrop-filter: blur(20px);}
  .brand{display:flex; gap:12px; align-items:center}
  .logo{width:46px;height:46px;border-radius:12px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#fff; font-weight:700; font-size: 20px; box-shadow: 0 0 20px rgba(41, 151, 255, 0.4);}
  .title{font-weight:700;font-size:18px}
  .top-controls{display:flex;gap:10px;align-items:center}
  .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--accent);cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,var(--accent),#00a7ff); color:#032; border:none}
  .search{padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.01); color:inherit}
  main{padding:40px 20px; max-width: 1200px; margin: 0 auto;}
  
  .categories-wrapper { display: flex; justify-content: center; margin-bottom: 40px; overflow-x: auto; padding-bottom: 10px; }
  .categories { display: flex; gap: 10px; }
  .cat-btn { padding: 10px 24px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); background: var(--card); color: var(--muted); cursor: pointer; font-size: 15px; transition: 0.3s; white-space: nowrap; }
  .cat-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
  .cat-btn.active { background: var(--text); color: #000; border-color: var(--text); font-weight: 600; }

  .products{display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:30px; scroll-margin-top: 120px;}
  .product{background:var(--card); padding:30px; border-radius:30px; border:1px solid rgba(255,255,255,0.05); display:flex; flex-direction:column; gap:15px; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); align-items: center; text-align: center; position: relative; overflow: hidden;}
  .product img{width:100%; height:220px; object-fit:contain; margin-bottom: 10px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3)); transition: 0.3s;}
  .product:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.1); }
  .product:hover img { transform: scale(1.1); }
  .product h4{margin:0;font-size:20px; font-weight: 600; color: #fff;}
  .price{color:var(--text); font-weight:600; font-size: 18px;}
  .small{font-size:13px;color:var(--muted)}
  .cart-panel{position:fixed; right:18px; bottom:18px; width:340px; max-height:70vh; overflow:auto}
  .cart-list{display:flex;flex-direction:column;gap:10px}
  .cart-item{display:flex;gap:10px;align-items:center;padding:10px;background:rgba(255,255,255,0.01);border-radius:8px}
  .qty{display:flex;gap:6px;align-items:center}
  footer{padding:18px;text-align:center;color:var(--muted);font-size:13px}
  /* responsive */
  @media(max-width:900px){
      main{padding:12px} 
      .products { grid-template-columns: repeat(2, 1fr) !important; }
      .product img { height: 140px !important; }
      .product { padding: 15px; border-radius: 20px; }
  }
  
  /* Modal for Product View only */
  .modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6); z-index: 9999;}
  .modal.open{display:flex}
  .modal .box{width:360px;padding:24px;border-radius:24px;background:rgba(28, 28, 30, 0.95);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 40px rgba(0,0,0,0.6);}
  input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04); background:transparent;color:inherit;margin-top:8px}
  .flex{display:flex;gap:8px}
  .product-actions{margin-top:auto;display:flex;gap:8px}

  /* snow tiny */
  .snowflake{position:fixed; top:-20px; z-index:9999; pointer-events:none; opacity:0.9; animation:fall linear infinite}
  @keyframes fall{to{transform:translateY(110vh)}}
  
  /* Toast Notifications */
  .toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
  .toast { background: rgba(15, 23, 32, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 12px 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateX(120%); transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); display: flex; align-items: center; gap: 12px; min-width: 280px; pointer-events: auto; }
  .toast.show { transform: translateX(0); }
  .toast.success { border-left: 4px solid #00ff88; } .toast.success i { color: #00ff88; }
  .toast.error { border-left: 4px solid #ff4757; } .toast.error i { color: #ff4757; }
  .toast.info { border-left: 4px solid #00e6c3; } .toast.info i { color: #00e6c3; }

  /* Settings Panel */
  .settings-btn { position: fixed; left: 20px; bottom: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--card); border: 1px solid rgba(255,255,255,0.1); color: var(--accent); font-size: 24px; cursor: pointer; z-index: 9000; display: flex; align-items: center; justify-content: center; transition: 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
  .settings-btn:hover { transform: rotate(90deg); color: #fff; }
  .settings-panel { position: fixed; left: 80px; bottom: 20px; width: 280px; background: rgba(15, 23, 32, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 16px; z-index: 9000; display: none; animation: slideUp 0.3s ease; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
  .settings-panel.open { display: block; }
  @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .season-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 8px; }
  .season-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px; cursor: pointer; font-size: 20px; transition: 0.2s; }
  .season-btn:hover, .season-btn.active { background: var(--accent); color: #000; transform: scale(1.1); }
  .weather-particle { position: fixed; top: -20px; z-index: 9999; pointer-events: none; opacity: 0.8; animation: fall linear infinite; }
  body.no-anim * { animation: none !important; transition: none !important; }

  /* New FX: Cursor Trail & 3D Tilt */
  .cursor-trail { position: fixed; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; z-index: 9999; animation: trailFade 0.6s linear forwards; background: var(--accent); box-shadow: 0 0 10px var(--accent); }
  @keyframes trailFade { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(0.2); } }

  /* Hero Section */
  .hero-wrapper { position: relative; width: 100%; height: 85vh; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #000; }
  .hero-content { text-align: center; z-index: 2; animation: fadeInUp 1s ease; }
  .hero-content h1 { font-size: 5rem; margin: 0; color: #f5f5f7; letter-spacing: -2px; font-weight: 600; }
  .hero-content p { font-size: 1.5rem; color: var(--muted); margin: 10px 0 30px; font-weight: 400; max-width: 600px; margin-left: auto; margin-right: auto; }
  .hero-img { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0.6; z-index: 1; mask-image: linear-gradient(to bottom, black 60%, transparent 100%); }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  /* Preloader */
  #preloader { position: fixed; left: 0; top: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
  .loader-spinner { width: 50px; height: 50px; border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .product { transform-style: preserve-3d; perspective: 1000px; position: relative; overflow: hidden; }
  .product::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent); transition: 0.5s; pointer-events: none; }
  .product:hover::before { left: 100%; }
  
  .switch-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; padding: 8px 10px; background: rgba(255,255,255,0.03); border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 14px; }
  .switch-row:hover { background: rgba(255,255,255,0.06); }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 8px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--card); border-radius: 4px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

  /* Specs Table */
  .specs-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
  .specs-table td { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
  .specs-table td:first-child { color: var(--muted); width: 40%; }
  .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 20px; margin-top: 15px; border: 1px solid rgba(255,255,255,0.1); }
  .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

  /* Variants (Memory & Color) */
  .variant-section { margin-bottom: 20px; }
  .variant-title { font-size: 14px; color: var(--muted); margin-bottom: 8px; }
  .variant-grid { display: flex; gap: 10px; flex-wrap: wrap; }
  .variant-btn { padding: 10px 16px; border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; background: rgba(255,255,255,0.05); color: #fff; cursor: pointer; transition: 0.2s; flex: 1; min-width: 80px; font-size: 14px; }
  .variant-btn:hover { background: rgba(255,255,255,0.1); }
  .variant-btn.active { border-color: var(--accent); background: rgba(41, 151, 255, 0.15); color: var(--accent); font-weight: 600; }
  .color-grid { display: flex; gap: 12px; }
  .color-btn { width: 36px; height: 36px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); cursor: pointer; transition: 0.2s; position: relative; }
  .color-btn.active { border-color: var(--accent); transform: scale(1.1); }

  /* Top-tier Video Modal & Hero Button */
  .hero-btn {
    display: inline-flex; align-items: center; gap: 12px;
    padding: 14px 32px; border-radius: 50px;
    background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
    backdrop-filter: blur(10px); color: #fff; font-size: 16px; font-weight: 600;
    cursor: pointer; transition: all 0.3s ease; text-decoration: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; overflow: hidden;
  }
  .hero-btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px) scale(1.02); box-shadow: 0 20px 40px rgba(0,0,0,0.4); border-color: #fff; }
  .hero-btn::after { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: 0.5s; }
  .hero-btn:hover::after { left: 100%; }
  .hero-btn i { color: #ff0000; font-size: 22px; filter: drop-shadow(0 0 10px rgba(255,0,0,0.5)); }

  .video-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 11000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.4s; backdrop-filter: blur(5px); }
  .video-overlay.active { display: flex; opacity: 1; }
  .video-wrapper { width: 90%; max-width: 1100px; aspect-ratio: 16/9; background: #000; border-radius: 24px; overflow: hidden; box-shadow: 0 0 80px rgba(0,230,195,0.15); transform: scale(0.9); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 1px solid rgba(255,255,255,0.1); }
  .video-overlay.active .video-wrapper { transform: scale(1); }
  .close-video { position: absolute; top: 30px; right: 40px; color: #fff; font-size: 50px; cursor: pointer; z-index: 11001; transition: 0.3s; line-height: 1; opacity: 0.7; }
  .close-video:hover { color: var(--accent); transform: rotate(90deg); opacity: 1; }

  /* Advantages Section */
  .advantages-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 60px; animation: fadeInUp 1s ease 0.3s backwards; }
  .adv-card { background: var(--card); padding: 30px; border-radius: 24px; text-align: center; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s; position: relative; overflow: hidden; }
  .adv-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.1); }
  .adv-card i { font-size: 40px; color: var(--accent); margin-bottom: 20px; background: rgba(41, 151, 255, 0.1); width: 80px; height: 80px; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; }
  .adv-card h3 { margin: 10px 0; font-size: 20px; color: #fff; }
  .adv-card p { color: var(--muted); font-size: 15px; margin: 0; line-height: 1.5; }

  /* Footer Enhanced */
  footer { background: #0a0a0a; padding: 60px 20px; margin-top: 60px; border-top: 1px solid rgba(255,255,255,0.05); text-align: left; }
  .footer-content { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; }
  .footer-col h4 { color: #fff; margin-bottom: 20px; font-size: 16px; }
  .footer-col a { display: block; color: var(--muted); text-decoration: none; margin-bottom: 10px; transition: 0.2s; font-size: 14px; }
  .footer-col a:hover { color: var(--accent); }
  .footer-bottom { text-align: center; margin-top: 60px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.05); color: var(--muted); font-size: 13px; }

  /* Promo Shop Grid */
  .promo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin: 20px 0; }
  .promo-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 20px 10px; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; }
  .promo-card:hover { transform: translateY(-5px); background: rgba(41, 151, 255, 0.1); border-color: var(--accent); }
  .promo-discount { font-size: 28px; font-weight: 800; color: #fff; margin: 10px 0; }
  .promo-price { color: var(--accent); font-weight: 600; font-size: 16px; }
  
  .input-success { border-color: #00ff88 !important; background: rgba(0, 255, 136, 0.1) !important; }
  .input-error { border-color: #ff4757 !important; background: rgba(255, 71, 87, 0.1) !important; }
</style>
</head>
<body>

<!-- Preloader -->
<div id="preloader"><div class="loader-spinner"></div></div>

<header>
  <div class="brand">
    <div class="logo">S</div>
    <div>
      <div class="title">SANDEX SHOP</div>
      <div class="small">Apple ‚Ä¢ Dyson ‚Ä¢ Consoles ‚Ä¢ Accessories</div>
    </div>
  </div>

  <div class="top-controls">
    <div style="position:relative; display:flex; align-items:center;">
        <input id="search" class="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä–∞–º..." oninput="renderProducts()" style="margin-top:0; padding-right:35px;">
        <button onclick="startVoiceSearch()" style="position:absolute; right:5px; background:none; border:none; color:var(--muted); cursor:pointer; font-size:16px;" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–∏—Å–∫"><i class="fas fa-microphone"></i></button>
    </div>
    <button class="btn" onclick="openPromoShop()">üéÅ –ö—É–ø–∏—Ç—å –ü—Ä–æ–º–æ–∫–æ–¥</button>
    <button class="btn" onclick="window.location.href='login.html'">–í–æ–π—Ç–∏ / –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <button class="btn" onclick="openCart()">–ö–æ—Ä–∑–∏–Ω–∞ üõí <span id="cart-count">0</span></button>
  </div>
</header>

<!-- Hero Section -->
<div class="hero-wrapper">
    <div class="hero-content">
        <h1>Titanium.</h1>
        <p>iPhone 15 Pro Max. So strong. So light.</p>
        <div style="display:flex; gap:15px; justify-content:center;">
            <button class="btn primary" style="padding: 12px 30px; border-radius: 30px; font-size: 16px;" onclick="document.getElementById('products').scrollIntoView({behavior:'smooth'})">–ö—É–ø–∏—Ç—å</button>
            <button class="hero-btn" onclick="openVideo('aEcvYmzMhGY')">–°–º–æ—Ç—Ä–µ—Ç—å –û–±–∑–æ—Ä</button>
        </div>
    </div>
    <img src="https://www.apple.com/v/iphone-15-pro/c/images/overview/design/design_titanium_endframe__e6khc9d736eu_large.jpg" class="hero-img" alt="Hero">
</div>

<main>
  <!-- Advantages -->
  <div class="advantages-grid">
    <div class="adv-card">
      <i class="fas fa-shipping-fast"></i>
      <h3>–ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</h3>
      <p>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É –≤ —Ç–µ—á–µ–Ω–∏–µ 2 —á–∞—Å–æ–≤. –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ —Å—Ç—Ä–∞–Ω–µ –≤ –¥–µ–Ω—å –∑–∞–∫–∞–∑–∞.</p>
    </div>
    <div class="adv-card">
      <i class="fas fa-shield-alt"></i>
      <h3>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è</h3>
      <p>–ü–æ–ª–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è 1 –≥–æ–¥ –Ω–∞ –≤—Å—é —Ç–µ—Ö–Ω–∏–∫—É Apple. –°–µ—Ä–≤–∏—Å–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ.</p>
    </div>
    <div class="adv-card">
      <i class="fas fa-check-circle"></i>
      <h3>–û—Ä–∏–≥–∏–Ω–∞–ª 100%</h3>
      <p>–¢–æ–ª—å–∫–æ –Ω–æ–≤–∞—è, –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –∏ –Ω–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞. –õ—é–±—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
    </div>
  </div>

  <div class="categories-wrapper">
      <div class="categories" id="categories"></div>
  </div>

  <section style="flex:1">
    <div class="products" id="products"></div>
  </section>
</main>

<!-- Cart Modal -->
<div class="modal" id="cartModal">
  <div class="box">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h3 style="margin:0">üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
        <button onclick="closeCart()" style="background:none; border:none; color:var(--muted); cursor:pointer; font-size:20px;">&times;</button>
    </div>
    
    <div id="cartItems" class="cart-list" style="max-height: 400px; overflow-y: auto; margin-bottom: 15px;"></div>
    
    <!-- Bonus Slider -->
    <div id="bonusSection" style="display:none; margin-bottom:15px; padding:12px; background:rgba(255,255,255,0.05); border-radius:8px; border:1px solid rgba(255,255,255,0.1);">
        <div style="display:flex; justify-content:space-between; font-size:14px; margin-bottom:8px;">
            <span>–ë–æ–Ω—É—Å—ã (–¥–æ—Å—Ç—É–ø–Ω–æ: <b id="availPoints" style="color:var(--accent)">0</b>)</span>
            <span style="color:#00ff88">–°–∫–∏–¥–∫–∞: -<span id="bonusDiscount">0</span> ‚Ç∏</span>
        </div>
        <input type="range" id="bonusSlider" value="0" min="0" step="10" style="width:100%; accent-color: var(--accent); cursor:pointer;" oninput="updateCartTotal()">
        <div style="text-align:right; font-size:12px; color:var(--muted); margin-top:4px;">–°–ø–∏—Å–∞—Ç—å: <span id="spendPoints">0</span></div>
    </div>

    <div class="flex" style="justify-content:space-between; align-items:center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
      <div style="font-size:1.2em; font-weight:bold;">–ò—Ç–æ–≥–æ: <span id="cartTotal">0</span> ‚Ç∏</div>
      <button class="btn primary" onclick="checkout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
  </div>
</div>

<!-- Promo Shop Modal -->
<div class="modal" id="promoShopModal">
  <div class="box" style="text-align:center; width: 700px; max-width: 95%;">
    <h2 style="margin-top:0;">üíé –ú–∞–≥–∞–∑–∏–Ω –ü—Ä–æ–º–æ–∫–æ–¥–æ–≤</h2>
    <p class="small">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–º–∏–Ω–∞–ª. –ö–æ–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
    
    <div class="promo-grid">
        <div class="promo-card" onclick="buyPromo(500, 0.7, 'SILVER')">
            <div class="small">Silver</div>
            <div class="promo-discount">-30%</div>
            <div class="promo-price">500 ‚Ç∏</div>
        </div>
        <div class="promo-card" onclick="buyPromo(2000, 0.55, 'GOLD')">
            <div class="small" style="color:#ffd700">Gold</div>
            <div class="promo-discount">-45%</div>
            <div class="promo-price">2 000 ‚Ç∏</div>
        </div>
        <div class="promo-card" onclick="buyPromo(5000, 0.4, 'PLATINUM')">
            <div class="small" style="color:#e5e4e2">Platinum</div>
            <div class="promo-discount">-60%</div>
            <div class="promo-price">5 000 ‚Ç∏</div>
        </div>
        <div class="promo-card" onclick="buyPromo(10000, 0.25, 'DIAMOND')">
            <div class="small" style="color:#b9f2ff">Diamond</div>
            <div class="promo-discount">-75%</div>
            <div class="promo-price">10 000 ‚Ç∏</div>
        </div>
        <div class="promo-card" onclick="buyPromo(20000, 0.1, 'LEGEND')">
            <div class="small" style="color:#ff4757">Legend</div>
            <div class="promo-discount">-90%</div>
            <div class="promo-price">20 000 ‚Ç∏</div>
        </div>
    </div>
    
    <button class="btn" style="width:100%;" onclick="document.getElementById('promoShopModal').classList.remove('open')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- Settings Button & Panel -->
<button id="settingsBtn" class="settings-btn" onclick="toggleSettings()"><i class="fas fa-cog"></i></button>
<div id="settingsPanel" class="settings-panel">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
        <h3 style="margin:0">üé® –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <button onclick="toggleSettings()" style="background:none; border:none; color:var(--muted); cursor:pointer;">‚úï</button>
    </div>
    
    <div style="margin-bottom:16px;">
        <div class="small">–ü–æ–≥–æ–¥–∞ / –°–µ–∑–æ–Ω</div>
        <div class="season-grid">
            <button class="season-btn" data-season="winter" onclick="setSeason('winter')" title="–ó–∏–º–∞">‚ùÑÔ∏è</button>
            <button class="season-btn" data-season="spring" onclick="setSeason('spring')" title="–í–µ—Å–Ω–∞">üå∏</button>
            <button class="season-btn" data-season="summer" onclick="setSeason('summer')" title="–õ–µ—Ç–æ">‚òÄÔ∏è</button>
            <button class="season-btn" data-season="autumn" onclick="setSeason('autumn')" title="–û—Å–µ–Ω—å">üçÇ</button>
        </div>
    </div>

    <div style="margin-bottom:16px; display:flex; gap:10px;">
        <div style="flex:1">
            <div class="small" style="font-size:11px; margin-bottom:4px;">–ê–∫—Ü–µ–Ω—Ç</div>
            <input type="color" id="accentPicker" style="width:100%; height:35px; padding:0; border:none; border-radius:4px; cursor:pointer;" oninput="setThemeColor(this.value)">
        </div>
        <div style="flex:1">
            <div class="small" style="font-size:11px; margin-bottom:4px;">–§–æ–Ω</div>
            <input type="color" id="bgPicker" style="width:100%; height:35px; padding:0; border:none; border-radius:4px; cursor:pointer;" oninput="setBgColor(this.value)">
        </div>
        <div style="flex:1">
            <div class="small" style="font-size:11px; margin-bottom:4px;">–ö–∞—Ä—Ç–æ—á–∫–∏</div>
            <input type="color" id="cardPicker" style="width:100%; height:35px; padding:0; border:none; border-radius:4px; cursor:pointer;" oninput="setCardColor(this.value)">
        </div>
    </div>

    <div style="margin-bottom:16px;">
        <div class="small" style="margin-bottom:8px; font-weight:bold; color:var(--accent);">‚ú® –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</div>
        <label class="switch-row">
            <span>‚ö° –û–±—â–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏</span>
            <input type="checkbox" id="animCheck" checked onchange="toggleAnimations(this.checked)">
        </label>
        <label class="switch-row">
            <span>üßä 3D –ö–∞—Ä—Ç–æ—á–∫–∏ (Tilt)</span>
            <input type="checkbox" id="tiltCheck" checked onchange="toggleTilt(this.checked)">
        </label>
        <label class="switch-row">
            <span>üí´ –ú–∞–≥–∏—á–µ—Å–∫–∏–π —Å–ª–µ–¥</span>
            <input type="checkbox" id="trailCheck" checked onchange="toggleTrail(this.checked)">
        </label>
    </div>
    
    <button class="btn" onclick="resetSettings()" style="width:100%; border:1px solid #ff4757; color:#ff4757; background:transparent;">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</div>

<!-- Order success modal -->
<div class="modal" id="orderModal">
  <div class="box">
    <h3>–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ‚úÖ</h3>
    <p class="small">–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ Kaspi Gold.</p>
    <div style="background:rgba(0,0,0,0.2); padding:12px; border-radius:8px; margin:12px 0; text-align:center; border: 1px solid var(--accent);">
        <p style="margin:0; color:var(--muted); font-size:12px;">–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ KASPI GOLD</p>
        <h4 style="margin:4px 0; color:var(--accent); letter-spacing:2px; font-size: 1.2em;">4400 4300 7522 9366</h4>
        <p style="margin:4px 0; color:var(--muted); font-size:12px;">–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —á–µ–∫ –≤ Telegram.</p>
    </div>
    <p class="small">–ú—ã —Ç–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞—è–≤–∫—É –≤ Telegram (–µ—Å–ª–∏ –±–æ—Ç —É–∫–∞–∑–∞–Ω). –°—á—ë—Ç/–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–¥—É—Ç –≤ —á–∞—Ç.</p>
    <div style="height:8px"></div>
    <div class="flex">
        <button class="btn primary" onclick="closeOrder()">–û–∫, —è –æ–ø–ª–∞—á—É</button>
        <a class="btn" href="https://t.me/c/3615687884/1" target="_blank">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫</a>
    </div>
  </div>
</div>

<!-- Fullscreen Video Modal -->
<div id="videoOverlay" class="video-overlay" onclick="closeVideo()">
    <div class="close-video">&times;</div>
    <div class="video-wrapper">
        <div id="videoPlayer" style="width:100%; height:100%;"></div>
    </div>
</div>

<footer>
  <div class="footer-content">
    <div class="footer-col">
      <h4>–ú–∞–≥–∞–∑–∏–Ω</h4>
      <a href="#">iPhone</a>
      <a href="#">iPad</a>
      <a href="#">Mac</a>
      <a href="#">Watch</a>
    </div>
    <div class="footer-col">
      <h4>–ü–æ–∫—É–ø–∞—Ç–µ–ª—è–º</h4>
      <a href="#">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a>
      <a href="#">–ì–∞—Ä–∞–Ω—Ç–∏—è</a>
      <a href="#">–ö—Ä–µ–¥–∏—Ç</a>
      <a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
    </div>
  </div>
  <div class="footer-bottom">
    ¬© 2024 SANDEX SHOP. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. –î–∏–∑–∞–π–Ω: Premium Apple Style.
  </div>
</footer>

<script>
/* ================== –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ) ================== */
const BOT_TOKEN = "8544071500:AAFhPQMDtuiNhB3gUxsDVIt8l8REa2fyZTo";
const CHAT_ID   = "1177193799";
const SUPPORT_URL = "https://t.me/c/3615687884/5"; // –°—Å—ã–ª–∫–∞ –Ω–∞ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
/* ======================================================================= */

/* ========== demo products ========== */
const PRODUCTS = [
  // iPhone 17 Series
  {
    id:201, cat:'iphone', name:'iPhone 17 Pro Max', price:799990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-pro-max-natural-titanium-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'–§–ª–∞–≥–º–∞–Ω. –¢–∏—Ç–∞–Ω.', video:'xqyUdNxWazA', 
    specs:{'–≠–∫—Ä–∞–Ω':'6.9" Super Retina XDR','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A19 Pro','–ö–∞–º–µ—Ä–∞':'48MP Pro System','–ë–∞—Ç–∞—Ä–µ—è':'4852 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–¢–∏—Ç–∞–Ω'},
    variants: {
        memory: [{l:'256 GB', p:0}, {l:'512 GB', p:100000}, {l:'1 TB', p:250000}, {l:'2 TB', p:450000}],
        color: [{l:'Natural Titanium', c:'#bebdb8'}, {l:'Blue Titanium', c:'#2f3846'}, {l:'White Titanium', c:'#f2f1ed'}, {l:'Black Titanium', c:'#181819'}]
    }
  },
  {
    id:202, cat:'iphone', name:'iPhone 17 Pro', price:699990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-pro-blue-titanium-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'–ú–æ—â—å –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º –∫–æ—Ä–ø—É—Å–µ.', video:'xqyUdNxWazA', 
    specs:{'–≠–∫—Ä–∞–Ω':'6.3" Super Retina XDR','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A19 Pro','–ö–∞–º–µ—Ä–∞':'48MP Pro System','–ë–∞—Ç–∞—Ä–µ—è':'3650 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–¢–∏—Ç–∞–Ω'},
    variants: {
        memory: [{l:'256 GB', p:0}, {l:'512 GB', p:100000}, {l:'1 TB', p:250000}],
        color: [{l:'Natural Titanium', c:'#bebdb8'}, {l:'Blue Titanium', c:'#2f3846'}, {l:'White Titanium', c:'#f2f1ed'}, {l:'Black Titanium', c:'#181819'}]
    }
  },
  {
    id:203, cat:'iphone', name:'iPhone Air', price:649990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-plus-pink-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —Ç–æ–Ω–∫–∏–π.', video:'0-U_y1k_HRA', 
    specs:{'–≠–∫—Ä–∞–Ω':'6.6" Slim OLED','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A19','–ö–∞–º–µ—Ä–∞':'48MP Single','–ë–∞—Ç–∞—Ä–µ—è':'3500 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–£–ª—å—Ç—Ä–∞—Ç–æ–Ω–∫–∏–π'},
    variants: {
        memory: [{l:'256 GB', p:0}, {l:'512 GB', p:80000}, {l:'1 TB', p:180000}],
        color: [{l:'Midnight', c:'#1e1e1e'}, {l:'Starlight', c:'#f0f0f0'}, {l:'Purple', c:'#e5ddea'}, {l:'Blue', c:'#c0cfde'}]
    }
  },
  {
    id:204, cat:'iphone', name:'iPhone 17', price:499990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-green-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'–ù–æ–≤—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç.', video:'0-U_y1k_HRA', 
    specs:{'–≠–∫—Ä–∞–Ω':'6.1" Super Retina XDR','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A19','–ö–∞–º–µ—Ä–∞':'48MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'3561 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–ê–ª—é–º–∏–Ω–∏–π'},
    variants: {
        memory: [{l:'256 GB', p:0}, {l:'512 GB', p:80000}],
        color: [{l:'Black', c:'#1e1e1e'}, {l:'Green', c:'#e3f4e6'}, {l:'Yellow', c:'#fbf7d5'}, {l:'Pink', c:'#fce6ea'}]
    }
  },
  // iPhone 15 Series
  {id:101, cat:'iphone', name:'iPhone 15 Pro Max', price:634990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-pro-max-natural-titanium-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'256GB, Natural Titanium', video:'xqyUdNxWazA', specs:{'–≠–∫—Ä–∞–Ω':'6.7" Super Retina XDR','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A17 Pro','–ö–∞–º–µ—Ä–∞':'48MP + 12MP + 12MP','–ë–∞—Ç–∞—Ä–µ—è':'4422 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–¢–∏—Ç–∞–Ω'}},
  {id:102, cat:'iphone', name:'iPhone 15 Pro', price:564990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-pro-blue-titanium-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Blue Titanium', video:'xqyUdNxWazA', specs:{'–≠–∫—Ä–∞–Ω':'6.1" Super Retina XDR','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A17 Pro','–ö–∞–º–µ—Ä–∞':'48MP + 12MP + 12MP','–ë–∞—Ç–∞—Ä–µ—è':'3274 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–¢–∏—Ç–∞–Ω'}},
  {id:103, cat:'iphone', name:'iPhone 15 Plus', price:424990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-plus-pink-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Pink', video:'0-U_y1k_HRA', specs:{'–≠–∫—Ä–∞–Ω':'6.7" Super Retina XDR','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A16 Bionic','–ö–∞–º–µ—Ä–∞':'48MP + 12MP','–ë–∞—Ç–∞—Ä–µ—è':'4383 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–ê–ª—é–º–∏–Ω–∏–π'}},
  {id:104, cat:'iphone', name:'iPhone 15', price:364990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-15-green-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Green', video:'0-U_y1k_HRA', specs:{'–≠–∫—Ä–∞–Ω':'6.1" Super Retina XDR','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A16 Bionic','–ö–∞–º–µ—Ä–∞':'48MP + 12MP','–ë–∞—Ç–∞—Ä–µ—è':'3349 –º–ê—á','–ö–æ—Ä–ø—É—Å':'–ê–ª—é–º–∏–Ω–∏–π'}},
  // iPhone 14 Series
  {id:105, cat:'iphone', name:'iPhone 14 Pro Max', price:519990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-14-pro-max-deep-purple-select-202209?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Deep Purple', video:'FT3ODSg1GFE', specs:{'–≠–∫—Ä–∞–Ω':'6.7" OLED 120Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A16 Bionic','–ö–∞–º–µ—Ä–∞':'48MP Pro','–ë–∞—Ç–∞—Ä–µ—è':'4323 –º–ê—á'}},
  {id:111, cat:'iphone', name:'iPhone 14 Pro', price:459990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-14-pro-gold-select-202209?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Gold', video:'FT3ODSg1GFE', specs:{'–≠–∫—Ä–∞–Ω':'6.1" OLED 120Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A16 Bionic','–ö–∞–º–µ—Ä–∞':'48MP Pro','–ë–∞—Ç–∞—Ä–µ—è':'3200 –º–ê—á'}},
  {id:112, cat:'iphone', name:'iPhone 14 Plus', price:359990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-14-plus-purple-select-202209?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Purple', video:'c5B6F7Jb2qg', specs:{'–≠–∫—Ä–∞–Ω':'6.7" OLED 60Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A15 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'4325 –º–ê—á'}},
  {id:106, cat:'iphone', name:'iPhone 14', price:314990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-14-blue-select-202209?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Blue', video:'c5B6F7Jb2qg', specs:{'–≠–∫—Ä–∞–Ω':'6.1" OLED 60Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A15 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'3279 –º–ê—á'}},
  // iPhone 13 Series
  {id:113, cat:'iphone', name:'iPhone 13 Pro Max', price:429990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-pro-max-silver-select-2021?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Silver', video:'7wUT7q-hRMA', specs:{'–≠–∫—Ä–∞–Ω':'6.7" OLED 120Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A15 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Pro','–ë–∞—Ç–∞—Ä–µ—è':'4352 –º–ê—á'}},
  {id:114, cat:'iphone', name:'iPhone 13 Pro', price:389990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-pro-graphite-select-2021?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Graphite', video:'7wUT7q-hRMA', specs:{'–≠–∫—Ä–∞–Ω':'6.1" OLED 120Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A15 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Pro','–ë–∞—Ç–∞—Ä–µ—è':'3095 –º–ê—á'}},
  {id:107, cat:'iphone', name:'iPhone 13', price:264990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-midnight-select-2021?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Midnight', video:'m43rh-pI0P0', specs:{'–≠–∫—Ä–∞–Ω':'6.1" OLED 60Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A15 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'3227 –º–ê—á'}},
  {id:115, cat:'iphone', name:'iPhone 13 mini', price:249990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-13-mini-pink-select-2021?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Pink', video:'m43rh-pI0P0', specs:{'–≠–∫—Ä–∞–Ω':'5.4" OLED 60Hz','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A15 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'2406 –º–ê—á'}},
  // iPhone 12 Series
  {id:116, cat:'iphone', name:'iPhone 12 Pro Max', price:349990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-12-pro-max-gold-select-2020?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Gold', video:'cnXapYkboRQ', specs:{'–≠–∫—Ä–∞–Ω':'6.7" OLED','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A14 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Pro','–ë–∞—Ç–∞—Ä–µ—è':'3687 –º–ê—á'}},
  {id:117, cat:'iphone', name:'iPhone 12 Pro', price:319990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-12-pro-blue-select-2020?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Pacific Blue', video:'cnXapYkboRQ', specs:{'–≠–∫—Ä–∞–Ω':'6.1" OLED','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A14 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Pro','–ë–∞—Ç–∞—Ä–µ—è':'2815 –º–ê—á'}},
  {id:108, cat:'iphone', name:'iPhone 12', price:219990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-12-purple-select-2021?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'128GB, Purple', video:'65JrtwtTOdc', specs:{'–≠–∫—Ä–∞–Ω':'6.1" OLED','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A14 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'2815 –º–ê—á'}},
  {id:118, cat:'iphone', name:'iPhone 12 mini', price:189990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-12-mini-green-select-2020?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'64GB, Green', video:'65JrtwtTOdc', specs:{'–≠–∫—Ä–∞–Ω':'5.4" OLED','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A14 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'2227 –º–ê—á'}},
  // Older Models
  {id:119, cat:'iphone', name:'iPhone SE (2022)', price:179990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-se-starlight-select-202203?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'64GB, Starlight', video:'G8M_2z3Fh9M', specs:{'–≠–∫—Ä–∞–Ω':'4.7" Retina','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A15 Bionic','Touch ID':'–ï—Å—Ç—å','–ë–∞—Ç–∞—Ä–µ—è':'2018 –º–ê—á'}},
  {id:109, cat:'iphone', name:'iPhone 11', price:184990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-11-white-select-2019?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'64GB, White', video:'H4p6njjPV_o', specs:{'–≠–∫—Ä–∞–Ω':'6.1" LCD','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A13 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Dual','–ë–∞—Ç–∞—Ä–µ—è':'3110 –º–ê—á'}},
  {id:110, cat:'iphone', name:'iPhone XR', price:139990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-xr-coral-select-201809?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'64GB, Coral', video:'tG7q_Q_J-7s', specs:{'–≠–∫—Ä–∞–Ω':'6.1" LCD','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A12 Bionic','–ö–∞–º–µ—Ä–∞':'12MP Single','–ë–∞—Ç–∞—Ä–µ—è':'2942 –º–ê—á'}},
  {id:120, cat:'iphone', name:'iPhone SE (2020)', price:119990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/iphone-se-black-select-2020?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'64GB, Black', video:'SQIbeAk-bFA', specs:{'–≠–∫—Ä–∞–Ω':'4.7" Retina','–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä':'A13 Bionic','Touch ID':'–ï—Å—Ç—å','–ë–∞—Ç–∞—Ä–µ—è':'1821 –º–ê—á'}},
  // Other Categories
  {id:2,cat:'ipad', name:'iPad Air', price:259990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/ipad-air-select-wifi-spacegray-202203?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'64GB, Space Gray', video:'rzD-c5aL5qE', specs:{'–ß–∏–ø':'M1','–≠–∫—Ä–∞–Ω':'10.9" Liquid Retina','–ö–∞–º–µ—Ä–∞':'12MP','Touch ID':'–í –∫–Ω–æ–ø–∫–µ'}},
  {id:3,cat:'watch', name:'Apple Watch Series 8', price:139000, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/watch-s8-midnight-aluminum-midnight-sport-band-select-202209?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'GPS, 45mm', video:'UfawgQJICU8', specs:{'–î–∞—Ç—á–∏–∫–∏':'–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –ö–∏—Å–ª–æ—Ä–æ–¥','–≠–∫—Ä–∞–Ω':'Always-On Retina','–í–æ–¥–æ–∑–∞—â–∏—Ç–∞':'50–º','–ó–∞—Ä—è–¥–∫–∞':'–ë—ã—Å—Ç—Ä–∞—è'}},
  {id:4,cat:'appletv', name:'Apple TV 4K', price:59900, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/apple-tv-4k-hero-select-202210?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'32GB', video:'b8R-iL3-7s4', specs:{'–ß–∏–ø':'A15 Bionic','–í–∏–¥–µ–æ':'4K HDR','–ü—É–ª—å—Ç':'Siri Remote USB-C','–°–µ—Ç—å':'Wi-Fi 6'}},
  {id:5,cat:'acc', name:'MagSafe Charger', price:8900, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/MHXH3?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞', video:'A_6uG9ky7i8', specs:{'–ú–æ—â–Ω–æ—Å—Ç—å':'–î–æ 15–í—Ç','–†–∞–∑—ä–µ–º':'USB-C','–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å':'iPhone 12 –∏ –Ω–æ–≤–µ–µ','–î–ª–∏–Ω–∞':'1–º'}},
  {id:6,cat:'dyson', name:'Dyson V8', price:189990, img:'https://m.media-amazon.com/images/I/61A+b+32AQL._AC_SL1500_.jpg', desc:'–ü—ã–ª–µ—Å–æ—Å –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–π', video:'4s8QghCqM2Y', specs:{'–ú–æ—â–Ω–æ—Å—Ç—å':'115 AW','–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã':'40 –º–∏–Ω','–í–µ—Å':'2.6 –∫–≥','–§–∏–ª—å—Ç—Ä':'HEPA'}},
  {id:7,cat:'console', name:'PlayStation 5', price:264990, img:'https://media.gamestop.com/i/gamestop/11108141_ALT01/Sony-PlayStation-5-Console?$pdp2x$', desc:'–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è', video:'2Dedv12Jb1c', specs:{'GPU':'10.28 TFLOPs','SSD':'825GB','–ì–µ–π–º–ø–∞–¥':'DualSense','4K':'120Hz'}},
  {id:9,cat:'ipad', name:'iPad mini', price:229990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/ipad-mini-select-wifi-purple-202109?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'64GB', video:'Tj3XW-h552U', specs:{'–ß–∏–ø':'A15 Bionic','–≠–∫—Ä–∞–Ω':'8.3" Liquid Retina','–ö–∞–º–µ—Ä–∞':'12MP','USB-C':'–ï—Å—Ç—å'}},
  {id:10,cat:'acc', name:'AirPods Pro', price:94990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/MQD83?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'2-–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è', video:'Tbtg-u2fKqU', specs:{'–ß–∏–ø':'H2','–®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ':'2x –ª—É—á—à–µ','–ö–µ–π—Å':'MagSafe + –î–∏–Ω–∞–º–∏–∫','–í—Ä–µ–º—è':'–î–æ 30—á'}},
  {id:11,cat:'console', name:'Xbox Series X', price:249990, img:'https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE4mRni?ver=a707', desc:'1TB', video:'0tUqIHxHjao', specs:{'GPU':'12 TFLOPs','SSD':'1TB','4K':'120Hz','–ü—Ä–∏–≤–æ–¥':'4K Blu-ray'}},
  {id:12,cat:'dyson', name:'Dyson Supersonic', price:159990, img:'https://m.media-amazon.com/images/I/61aL-Ixx9QL._AC_SL1500_.jpg', desc:'–§–µ–Ω –ø—Ä–µ–º–∏—É–º', video:'yZ1Jj8Z9M0U', specs:{'–ú–æ—â–Ω–æ—Å—Ç—å':'1600 –í—Ç','–†–µ–∂–∏–º—ã':'4 —Ç–µ–º–ø / 3 —Å–∫–æ—Ä–æ—Å—Ç–∏','–ò–æ–Ω–∏–∑–∞—Ü–∏—è':'–ï—Å—Ç—å','–ù–∞—Å–∞–¥–∫–∏':'5 —à—Ç'}},
  {id:14,cat:'watch', name:'Apple Watch Ultra 2', price:369990, img:'https://store.storeimages.cdn-apple.com/4982/as-images.apple.com/is/watch-ultra-2-alp-loop-blue-select-202309?wid=512&hei=512&fmt=png-alpha&qlt=80', desc:'Titanium, 49mm', video:'c3Cq0syk_LI', specs:{'–ö–æ—Ä–ø—É—Å':'–¢–∏—Ç–∞–Ω 49–º–º','–Ø—Ä–∫–æ—Å—Ç—å':'3000 –Ω–∏—Ç','–ë–∞—Ç–∞—Ä–µ—è':'–î–æ 72—á','GPS':'L1 + L5'}},
  {id:15,cat:'dyson', name:'Dyson Airwrap', price:239990, img:'https://m.media-amazon.com/images/I/71o61-i3+wL._AC_SL1500_.jpg', desc:'–ú—É–ª—å—Ç–∏—Å—Ç–∞–π–ª–µ—Ä', video:'yZ1Jj8Z9M0U', specs:{'–≠—Ñ—Ñ–µ–∫—Ç':'–ö–æ–∞–Ω–¥–∞','–ù–∞—Å–∞–¥–∫–∏':'6 —à—Ç','–ö–µ–π—Å':'–ö–æ–∂–∞–Ω—ã–π','–ú–æ—â–Ω–æ—Å—Ç—å':'1300 –í—Ç'}},
  {id:16,cat:'console', name:'Nintendo Switch OLED', price:144990, img:'https://m.media-amazon.com/images/I/716O-1I2WpL._AC_SL1500_.jpg', desc:'White Joy-Con', video:'4mHq6Y7J7gk', specs:{'–≠–∫—Ä–∞–Ω':'7" OLED','–ü–∞–º—è—Ç—å':'64GB','–†–µ–∂–∏–º—ã':'–¢–í / –ù–∞—Å—Ç–æ–ª—å–Ω—ã–π / –ü–æ—Ä—Ç–∞—Ç–∏–≤','LAN':'–í –¥–æ–∫–µ'}},
];

let state = {
  user: null, // {user,name}
  cart: JSON.parse(localStorage.getItem('sandex_cart') || '[]'),
  orders: JSON.parse(localStorage.getItem('sandex_orders') || '[]'),
  filter: 'all',
};

/* helpers */
function saveCart(){ localStorage.setItem('sandex_cart', JSON.stringify(state.cart)); updateCartCount(); }
function saveOrders(){ localStorage.setItem('sandex_orders', JSON.stringify(state.orders)); }
function updateCartCount(){ document.getElementById('cart-count').innerText = state.cart.length; }

/* render categories */
function renderCategories(){
  const cats = ['all','iphone','ipad','watch','appletv','acc','dyson','console'];
  const names = {all:'üîç –í—Å–µ',iphone:'üì± Apple iPhone',ipad:'üíª Apple iPad',watch:'‚åö Apple Watch',appletv:'üì∫ Apple TV',acc:'üîå –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã',dyson:'üí® Dyson',console:'üéÆ –ü—Ä–∏—Å—Ç–∞–≤–∫–∏'};
  const el = document.getElementById('categories'); el.innerHTML='';
  cats.forEach(c=>{
    const btn = document.createElement('div');
    btn.className = 'cat-btn' + (state.filter===c ? ' active':'');
    btn.innerText = names[c];
    btn.onclick = ()=>{ state.filter=c; document.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); renderProducts(); }
    el.appendChild(btn);
  })
}

/* render products */
function renderProducts(){
  const q = document.getElementById('search').value.trim().toLowerCase();
  const wrap = document.getElementById('products'); wrap.innerHTML='';
  PRODUCTS.filter(p=>{
    if(state.filter!=='all' && p.cat!==state.filter) return false;
    if(q && !(p.name.toLowerCase().includes(q) || (p.desc && p.desc.toLowerCase().includes(q)))) return false;
    return true;
  }).forEach(p=>{
    const d = document.createElement('div'); d.className='product card';
    d.innerHTML = `<img src="${p.img}" alt=""><h4>${p.name}</h4><div class="small">${p.desc}</div><div class="price">${p.price.toLocaleString()} ‚Ç∏</div>
      <div class="product-actions" style="margin-top:auto; width:100%; display:flex; gap:10px; justify-content:center;"><button class="btn" style="flex:1" onclick="viewProduct(${p.id})">–û–±–∑–æ—Ä</button><button class="btn primary" style="flex:1" onclick="addToCart(${p.id})">–ö—É–ø–∏—Ç—å</button></div>`;
    wrap.appendChild(d);
  })
  setTimeout(initTilt, 100); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è 3D —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞
}

/* Toast System */
function showToast(msg, type='info') {
    let container = document.getElementById('toast-container');
    if(!container) {
        container = document.createElement('div');
        container.id = 'toast-container';
        container.className = 'toast-container';
        document.body.appendChild(container);
    }
    
    const icon = type==='success'?'check-circle':(type==='error'?'exclamation-circle':'info-circle');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `<i class="fas fa-${icon}"></i> <div>${msg}</div>`;
    container.appendChild(toast);
    
    // Trigger reflow
    requestAnimationFrame(() => toast.classList.add('show'));
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}
// Override alert
window.alert = function(msg) { showToast(msg, 'info'); }

/* Fake Reviews Generator */
function getFakeReviews() {
    const reviews = [
        { user: '–ê–ª–∏—Ö–∞–Ω', stars: 5, text: '–í–∞—É, —Ç–∞–∫ –∫—Ä—É—Ç–æ! –¢–µ–ª–µ—Ñ–æ–Ω –ø—Ä–æ—Å—Ç–æ –ª–µ—Ç–∞–µ—Ç üöÄ' },
        { user: '–ú–∞–¥–∏–Ω–∞', stars: 5, text: '–°–ø–∞—Å–∏–±–æ –∑–∞ –±—ã—Å—Ç—Ä—É—é –¥–æ—Å—Ç–∞–≤–∫—É! –í—Å—ë —Å—É–ø–µ—Ä.' },
        { user: '–ï—Ä–∂–∞–Ω', stars: 4, text: '–•–æ—Ä–æ—à–∏–π —Ç–æ–≤–∞—Ä, —É–ø–∞–∫–æ–≤–∫–∞ —Ü–µ–ª–∞—è. –†–µ–∫–æ–º–µ–Ω–¥—É—é.' },
        { user: '–ê–π–≥–µ—Ä–∏–º', stars: 5, text: '–õ—É—á—à–∞—è —Ü–µ–Ω–∞ –Ω–∞ —Ä—ã–Ω–∫–µ, —è –≤ –≤–æ—Å—Ç–æ—Ä–≥–µ! üòç' },
        { user: '–î–∏–º–∞—à', stars: 5, text: 'Sandpex –∫–∞–∫ –≤—Å–µ–≥–¥–∞ –Ω–∞ –≤—ã—Å–æ—Ç–µ. –¢–æ–ø –∑–∞ —Å–≤–æ–∏ –¥–µ–Ω—å–≥–∏.' },
        { user: '–ö–∞–º–∏–ª–∞', stars: 5, text: '–û—á–µ–Ω—å –∫—Ä—É—Ç–æ, —Å–ø–∞—Å–∏–±–æ –±–æ–ª—å—à–æ–µ!' }
    ];
    return reviews.sort(() => 0.5 - Math.random()).slice(0, 3);
}

/* Global selection state for modal */
let modalSelection = { id: null, basePrice: 0, memory: null, color: null, discount: 1 };

/* view product */
function viewProduct(id){
  const p = PRODUCTS.find(x=>x.id===id);
  if(!p) return;

  // Init selection
  modalSelection = { 
      id: p.id, 
      basePrice: p.price, 
      memory: p.variants?.memory ? p.variants.memory[0] : null,
      color: p.variants?.color ? p.variants.color[0] : null,
      discount: 1
  };
  
  const reviews = getFakeReviews();
  const reviewsHtml = reviews.map(r => `
    <div style="background:rgba(255,255,255,0.03); padding:10px; border-radius:8px; margin-bottom:8px;">
        <div style="display:flex; justify-content:space-between;">
            <b>${r.user}</b>
            <span style="color:#ffd700">${'‚òÖ'.repeat(r.stars)}</span>
        </div>
        <p class="small" style="margin:4px 0 0 0;">${r.text}</p>
    </div>
  `).join('');

  // Variants HTML
  let variantsHtml = '';
  if(p.variants) {
      if(p.variants.memory) {
          variantsHtml += `<div class="variant-section"><div class="variant-title">–ü–∞–º—è—Ç—å</div><div class="variant-grid">`;
          p.variants.memory.forEach((m, idx) => {
              const active = idx === 0 ? 'active' : '';
              variantsHtml += `<button class="variant-btn ${active}" onclick="selectMemory(${idx}, this)">${m.l}</button>`;
          });
          variantsHtml += `</div></div>`;
      }
      if(p.variants.color) {
          variantsHtml += `<div class="variant-section"><div class="variant-title">–¶–≤–µ—Ç: <span id="colorName">${p.variants.color[0].l}</span></div><div class="color-grid">`;
          p.variants.color.forEach((c, idx) => {
              const active = idx === 0 ? 'active' : '';
              variantsHtml += `<button class="color-btn ${active}" style="background:${c.c}" onclick="selectColor(${idx}, '${c.l}', this)" title="${c.l}"></button>`;
          });
          variantsHtml += `</div></div>`;
      }
  }
  
  // Specs HTML
  let specsHtml = '';
  if(p.specs) {
      specsHtml = '<table class="specs-table">' + Object.entries(p.specs).map(([k,v]) => `<tr><td>${k}</td><td>${v}</td></tr>`).join('') + '</table>';
  }

  const html = `<div class="modal" id="pvModal" style="display:flex;align-items:center;justify-content:center;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:9999">
    <div class="box" style="width:720px;max-width:95%;max-height:90vh;overflow-y:auto;">
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <img src="${p.img}" style="width:40%;min-width:250px;border-radius:8px;object-fit:cover;">
        <div style="flex:1;min-width:250px;">
          <h2>${p.name}</h2>
          <p class="small">${p.desc}</p>
          
          ${variantsHtml}

          ${specsHtml}

          <div id="modalPrice" style="font-weight:700;color:var(--accent);font-size:20px">${p.price.toLocaleString()} ‚Ç∏</div>
          <div id="modalMonthly" class="small" style="margin-top:4px; color:var(--muted);">–æ—Ç ${Math.floor(p.price/12).toLocaleString()} ‚Ç∏/–º–µ—Å</div>
          
          <!-- Promo Code Section -->
          <div style="margin:12px 0; display:flex; gap:8px;">
            <input id="promoInput" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" style="padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.1); background:rgba(0,0,0,0.2); color:#fff; width:140px;">
            <button class="btn" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
          </div>

          <div style="height:12px"></div>
          <div class="flex">
            <button class="btn" onclick="closePV()">–ó–∞–∫—Ä—ã—Ç—å</button>
            <a class="btn" href="${SUPPORT_URL}" target="_blank">üí¨ –°–ø—Ä–æ—Å–∏—Ç—å</a>
            <button id="modalAddBtn" class="btn primary" onclick="addToCartFromModal();">–í –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </div>
      </div>

      <!-- Video Review -->
      ${p.video ? `
      <div style="margin-top:20px;">
        <h3>üé• –í–∏–¥–µ–æ –æ–±–∑–æ—Ä</h3>
        <div class="video-container"><iframe src="https://www.youtube.com/embed/${p.video}" frameborder="0" allowfullscreen></iframe></div>
      </div>` : ''}
      
      <!-- Reviews Section -->
      <div style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:15px;">
        <h3>‚≠ê –û—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h3>
        ${reviewsHtml}
      </div>
    </div>
  </div>`;
  document.body.insertAdjacentHTML('beforeend', html);
}
function closePV(){ const m=document.getElementById('pvModal'); if(m) m.remove(); }

/* Variant Selection Logic */
function selectMemory(idx, btn) {
    const p = PRODUCTS.find(x => x.id === modalSelection.id);
    modalSelection.memory = p.variants.memory[idx];
    
    // Update UI
    btn.parentElement.querySelectorAll('.variant-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    updateModalPrice();
}

function selectColor(idx, name, btn) {
    const p = PRODUCTS.find(x => x.id === modalSelection.id);
    modalSelection.color = p.variants.color[idx];
    document.getElementById('colorName').innerText = name;
    
    btn.parentElement.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function updateModalPrice() {
    const base = modalSelection.basePrice + (modalSelection.memory ? modalSelection.memory.p : 0);
    const finalPrice = Math.floor(base * modalSelection.discount);
    
    const el = document.getElementById('modalPrice');
    const mEl = document.getElementById('modalMonthly');
    
    if(modalSelection.discount < 1) {
        el.innerHTML = `<span style="text-decoration:line-through; color:var(--muted); font-size:16px;">${base.toLocaleString()} ‚Ç∏</span>
                        <span style="color:#00ff88; margin-left:8px;">${finalPrice.toLocaleString()} ‚Ç∏</span>`;
    } else {
        el.innerText = finalPrice.toLocaleString() + ' ‚Ç∏';
    }
    
    if(mEl) mEl.innerText = `–æ—Ç ${Math.floor(finalPrice/12).toLocaleString()} ‚Ç∏/–º–µ—Å`;
}

/* Promo Logic */
const PROMO_CODES = {
    'SANDPEXIK_SHOP': 0.7,  // 30%
    'APPLE_SHOP': 0.85,     // 15%
    'FLUGER': 0.9,          // 10%
    'KOSTA': 0.95,          // 5%
    'SANDPEXIK': 0.75,      // 25% (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
    'SANDPEX': 0.55         // 45% (–ü–ª–∞—Ç–Ω—ã–π)
};

function applyPromo(){
    const input = document.getElementById('promoInput');
    const code = input.value.trim().toUpperCase();
    
    if(PROMO_CODES[code]) {
        modalSelection.discount = PROMO_CODES[code];
        updateModalPrice();
        showToast(`–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω! –°–∫–∏–¥–∫–∞ ${Math.round((1-modalSelection.discount)*100)}%`, 'success');
        input.classList.add('input-success');
        input.classList.remove('input-error');
    } else {
        showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥', 'error');
        input.classList.add('input-error');
        input.classList.remove('input-success');
    }
}

/* Promo Shop Logic */
function openPromoShop() {
    document.getElementById('promoShopModal').classList.add('open');
}

function buyPromo(price, discount, tier) {
    // Generate unique code
    const code = tier + '-' + Math.random().toString(36).substr(2, 6).toUpperCase();
    PROMO_CODES[code] = discount;

    const name = `–ü—Ä–æ–º–æ–∫–æ–¥ ${tier} [${code}] (-${Math.round((1-discount)*100)}%)`;
    const id = 'PROMO_' + tier + '_' + Date.now();
    addToCart(name, price, id);
    document.getElementById('promoShopModal').classList.remove('open');
}

/* cart logic */
function addToCartFromModal() {
    const p = PRODUCTS.find(x => x.id === modalSelection.id);
    let finalName = p.name;
    let basePrice = modalSelection.basePrice;
    let variantId = p.id.toString();

    if(modalSelection.memory) {
        finalName += ` (${modalSelection.memory.l})`;
        basePrice += modalSelection.memory.p;
        variantId += `-${modalSelection.memory.l}`;
    }
    if(modalSelection.color) {
        finalName += ` ${modalSelection.color.l}`;
        variantId += `-${modalSelection.color.l}`;
    }

    const finalPrice = Math.floor(basePrice * modalSelection.discount);

    addToCart(finalName, finalPrice, variantId);
    closePV();
}

function addToCart(idOrName, priceIfCustom, customId){
  let item;
  if(typeof idOrName === 'number'){
    const p = PRODUCTS.find(x=>x.id===idOrName); if(!p) return;
    const finalPrice = (priceIfCustom !== undefined) ? priceIfCustom : p.price;
    item = {id:p.id, name:p.name, price:finalPrice, qty:1};
  } else {
    item = {id: customId || Date.now(), name:idOrName, price:priceIfCustom||0, qty:1};
  }
  
  const exists = state.cart.find(c => c.id === item.id);
  
  if(exists) exists.qty++;
  else state.cart.push(item);
  saveCart();
  showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É', 'success');
}

/* cart modal logic */
function openCart(){ 
    document.getElementById('cartModal').classList.add('open'); 
    renderCartItems(); 
}
function closeCart(){ document.getElementById('cartModal').classList.remove('open'); }

function renderCartItems(){
  const el = document.getElementById('cartItems'); el.innerHTML='';
  let total = 0;
  
  if(state.cart.length === 0) {
      el.innerHTML = '<div style="text-align:center; padding:20px; color:var(--muted);">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>';
  } else {
      state.cart.forEach((c, idx)=>{
        total += c.price * c.qty;
        const div = document.createElement('div'); div.className='cart-item';
        div.innerHTML = `
          <div style="flex:1"><b>${c.name}</b><div class="small">${c.price.toLocaleString()} ‚Ç∏</div></div>
          <div class="qty">
            <button class="btn" onclick="changeQty(${idx},-1)" style="padding:4px 8px;">‚àí</button>
            <div style="min-width:20px;text-align:center">${c.qty}</div>
            <button class="btn" onclick="changeQty(${idx},1)" style="padding:4px 8px;">+</button>
          </div>
          <button class="btn" onclick="removeFromCart(${idx})" style="color:#ff4757; border-color:rgba(255,71,87,0.3); margin-left:10px;">‚úï</button>`;
        el.appendChild(div);
      });
  }
  
  // Bonus Logic Setup
  const users = JSON.parse(localStorage.getItem('sandex_users') || '[]');
  const currentUser = state.user ? users.find(u => u.user === state.user.user) : null;
  const points = currentUser ? (currentUser.points || 0) : 0;
  const bonusSection = document.getElementById('bonusSection');
  const slider = document.getElementById('bonusSlider');

  if(currentUser && points > 0 && total > 0) {
      bonusSection.style.display = 'block';
      document.getElementById('availPoints').innerText = points.toLocaleString();
      const maxUse = Math.min(points, total);
      slider.max = maxUse;
      if(parseInt(slider.value) > maxUse) slider.value = maxUse;
  } else {
      bonusSection.style.display = 'none';
      slider.value = 0;
  }
  
  updateCartTotal();
}

function updateCartTotal() {
    const rawTotal = state.cart.reduce((s,i)=>s+i.price*i.qty,0);
    const discount = parseInt(document.getElementById('bonusSlider').value) || 0;
    document.getElementById('spendPoints').innerText = discount;
    document.getElementById('bonusDiscount').innerText = discount.toLocaleString();
    document.getElementById('cartTotal').innerText = Math.max(0, rawTotal - discount).toLocaleString();
}

function changeQty(i, delta){
  if(!state.cart[i]) return;
  state.cart[i].qty += delta;
  if(state.cart[i].qty<1) state.cart.splice(i,1);
  saveCart(); renderCartItems();
}

function removeFromCart(i){ state.cart.splice(i,1); saveCart(); renderCartItems(); }

async function checkout(){
  if(state.cart.length===0){ showToast('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è', 'error'); return; }
  if(!state.user){ 
      if(confirm('–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞?')) window.location.href = 'login.html';
      return; 
  }

  const users = JSON.parse(localStorage.getItem('sandex_users') || '[]');
  const userIdx = users.findIndex(u => u.user === state.user.user);
  const spendPoints = parseInt(document.getElementById('bonusSlider').value) || 0;
  const rawTotal = state.cart.reduce((s,i)=>s+i.price*i.qty,0);
  const finalTotal = rawTotal - spendPoints;

  // Deduct points & Add Cashback logic would go here (simplified for demo)
  
  // Create Order
  const order = { id: 'ORD'+Date.now(), user: state.user, items: state.cart, total: finalTotal, discount: spendPoints, created: new Date().toISOString(), status: '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É' };
  state.orders.push(order); saveOrders();

  // Send to Telegram
  if(BOT_TOKEN && CHAT_ID){
    const textLines = [];
    textLines.push('üõí –ù–û–í–´–ô –ó–ê–ö–ê–ó');
    textLines.push(`üë§ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å: ${order.user.name || order.user.user}`);
    textLines.push(`üì¶ –¢–æ–≤–∞—Ä—ã:`);
    order.items.forEach(i=> textLines.push(`- ${i.name} (${i.qty} —à—Ç)`));
    if(spendPoints > 0) textLines.push(`üíé –°–ø–∏—Å–∞–Ω–æ –±–æ–Ω—É—Å–æ–≤: ${spendPoints}`);
    textLines.push(`üí∞ –ò—Ç–æ–≥–æ: ${order.total.toLocaleString()} ‚Ç∏`);

    try{
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ chat_id: CHAT_ID, text: textLines.join('\n') })
      });
    }catch(e){ console.error(e); }
  }

  state.cart = []; saveCart(); renderCartItems(); closeCart();
  document.getElementById('orderModal').classList.add('open');
}

/* profile display */
function renderProfile(){
  const area = document.getElementById('profile-area');
  const u = JSON.parse(localStorage.getItem('sandex_user')||'null');
  state.user = u;
  if(!u){
    area.innerHTML = `<p class="small">–í—ã –Ω–µ –≤–æ—à–ª–∏</p><button class="btn" onclick="window.location.href='login.html'">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>`;
  } else {
    area.innerHTML = `<p><b>${u.name||u.user}</b></p><p class="small">${u.user}</p><div style="height:10px"></div><a class="btn" href="profile.html" style="display:block;text-align:center;text-decoration:none;margin-bottom:8px">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a>
      <button class="btn" onclick="logout()">–í—ã–π—Ç–∏</button>`;
  }
}
function logout(){ localStorage.removeItem('sandex_user'); state.user=null; renderProfile(); }

/* order modal */
function closeOrder(){ document.getElementById('orderModal').classList.remove('open'); }

/* Voice Search */
function startVoiceSearch() {
  if (!('webkitSpeechRecognition' in window)) {
    showToast('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–∏—Å–∫', 'error');
    return;
  }
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'ru-RU';
  recognition.onresult = function(event) {
    const text = event.results[0][0].transcript;
    document.getElementById('search').value = text;
    renderProducts();
    showToast(`–ü–æ–∏—Å–∫: ${text}`, 'info');
  };
  recognition.start();
  showToast('–ì–æ–≤–æ—Ä–∏—Ç–µ...', 'info');
}

/* ================= CUSTOMIZATION LOGIC ================= */
function toggleSettings() {
    document.getElementById('settingsPanel').classList.toggle('open');
}

function setSeason(season) {
    localStorage.setItem('sandex_season', season);
    
    // Update UI buttons
    document.querySelectorAll('.season-btn').forEach(b => b.classList.remove('active'));
    document.querySelector(`.season-btn[data-season="${season}"]`)?.classList.add('active');
    
    // Clear particles
    document.querySelectorAll('.weather-particle').forEach(e => e.remove());
    
    const effects = {
        winter: { char: '‚ùÑ', color: '#fff' },
        spring: { char: 'üå∏', color: '#ffb7b2' },
        autumn: { char: 'üçÇ', color: '#ff9f43' },
        summer: { char: '‚òÄÔ∏è', color: '#ffd700' }
    };
    
    if(!effects[season]) return;
    
    // Summer special: just a few suns or clear sky
    const count = season === 'summer' ? 15 : 30; 
    
    for(let i=0; i<count; i++){
        let s = document.createElement('div');
        s.className = 'weather-particle';
        s.innerText = effects[season].char;
        s.style.left = Math.random()*100 + 'vw';
        s.style.fontSize = (10+Math.random()*20)+'px';
        s.style.animationDuration = (4+Math.random()*7)+'s';
        document.body.appendChild(s);
    }
}

function setThemeColor(color) {
    document.documentElement.style.setProperty('--accent', color);
    localStorage.setItem('sandex_accent', color);
}

function setBgColor(color) {
    document.documentElement.style.setProperty('--bg', color);
    localStorage.setItem('sandex_bg', color);
}

function setCardColor(color) {
    document.documentElement.style.setProperty('--card', color);
    localStorage.setItem('sandex_card', color);
}

/* ================= ADVANCED FX (–ú–∞–≥–∏—è) ================= */
let tiltEnabled = true;
let trailEnabled = true;

function toggleTilt(enabled) {
    tiltEnabled = enabled;
    localStorage.setItem('sandex_tilt', enabled);
    if(enabled) initTilt();
    else {
        // –°–±—Ä–æ—Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏
        document.querySelectorAll('.product').forEach(c => {
            c.style.transform = 'none';
            c.style.boxShadow = 'none';
            c.onmousemove = null;
            c.onmouseleave = null;
        });
    }
}

function initTilt() {
    if(!tiltEnabled) return;
    document.querySelectorAll('.product').forEach(card => {
        card.onmousemove = e => {
            if(!tiltEnabled) return;
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–∞–∫–ª–æ–Ω (–º–∞–∫—Å 20 –≥—Ä–∞–¥—É—Å–æ–≤)
            const xPct = (x / rect.width) - 0.5;
            const yPct = (y / rect.height) - 0.5;
            
            const rotateX = yPct * -20; 
            const rotateY = xPct * 20;

            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
            // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–µ–Ω—å
            card.style.boxShadow = `${-xPct*20}px ${-yPct*20}px 30px rgba(0,0,0,0.4)`;
        };
        card.onmouseleave = () => {
            card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
            card.style.boxShadow = 'none';
        };
    });
}

function toggleTrail(enabled) {
    trailEnabled = enabled;
    localStorage.setItem('sandex_trail', enabled);
}

// –õ–æ–≥–∏–∫–∞ —Å–ª–µ–¥–∞ –∫—É—Ä—Å–æ—Ä–∞
let lastTrailTime = 0;
document.addEventListener('mousemove', e => {
    if(!trailEnabled) return;
    const now = Date.now();
    if(now - lastTrailTime < 30) return; // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FPS —á–∞—Å—Ç–∏—Ü
    lastTrailTime = now;

    const p = document.createElement('div');
    p.className = 'cursor-trail';
    p.style.left = (e.clientX - 4) + 'px';
    p.style.top = (e.clientY - 4) + 'px';
    // –ë–µ—Ä–µ–º —Ç–µ–∫—É—â–∏–π —Ü–≤–µ—Ç —Ç–µ–º—ã
    const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
    p.style.background = accent;
    p.style.boxShadow = `0 0 10px ${accent}`;
    
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 600);
});

function toggleAnimations(enabled) {
    if(enabled) document.body.classList.remove('no-anim');
    else document.body.classList.add('no-anim');
    localStorage.setItem('sandex_anim', enabled);
}

function resetSettings() {
    localStorage.removeItem('sandex_season');
    localStorage.removeItem('sandex_accent');
    localStorage.removeItem('sandex_anim');
    localStorage.removeItem('sandex_bg');
    localStorage.removeItem('sandex_card');
    localStorage.removeItem('sandex_tilt');
    localStorage.removeItem('sandex_trail');
    location.reload();
}

function loadSettings() {
    const s = localStorage.getItem('sandex_season') || 'winter';
    setSeason(s);
    
    const c = localStorage.getItem('sandex_accent');
    if(c) { setThemeColor(c); document.getElementById('accentPicker').value = c; }

    const bg = localStorage.getItem('sandex_bg');
    if(bg) { setBgColor(bg); document.getElementById('bgPicker').value = bg; }

    const card = localStorage.getItem('sandex_card');
    if(card) { setCardColor(card); document.getElementById('cardPicker').value = card; }
    
    const a = localStorage.getItem('sandex_anim');
    if(a === 'false') {
        document.body.classList.add('no-anim');
        document.getElementById('animCheck').checked = false;
    }

    const t = localStorage.getItem('sandex_tilt');
    if(t === 'false') { document.getElementById('tiltCheck').checked = false; toggleTilt(false); }
    else toggleTilt(true);

    const tr = localStorage.getItem('sandex_trail');
    if(tr === 'false') { document.getElementById('trailCheck').checked = false; toggleTrail(false); }
    else toggleTrail(true);
}

/* Video Modal Logic */
function openVideo(videoId) {
    const overlay = document.getElementById('videoOverlay');
    const player = document.getElementById('videoPlayer');
    player.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
    overlay.classList.add('active');
}
function closeVideo() {
    const overlay = document.getElementById('videoOverlay');
    overlay.classList.remove('active');
    setTimeout(() => { document.getElementById('videoPlayer').innerHTML = ''; }, 400);
}

/* startup */
(function init(){
  // Remove preloader
  window.addEventListener('load', () => {
      const p = document.getElementById('preloader');
      p.style.opacity = '0';
      setTimeout(() => p.remove(), 500);
  });
  renderCategories(); renderProducts(); renderProfile(); updateCartCount();
  loadSettings();
})();
</script>

</body>
</html>
